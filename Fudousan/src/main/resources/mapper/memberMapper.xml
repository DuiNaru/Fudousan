<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.real.fudousan.member.dao.MemberMapper">
	<resultMap type="member" id="memberResultMap">
		<id property="memberId" column="member_id"/>
		<result property="creDate" column="member_cre_date"/>
		<result property="delDate" column="member_del_date"/>
		<result property="designer" column="designer"/>
		<result property="email" column="email"/>
		<result property="password" column="password"/>
		<result property="phone" column="phone"/>
		<result property="picture" column="picture"/>
		<result property="text" column="member_text"/>
		<result property="memberName" column="member_name"/>
		<!-- Permission -->
		<association property="permission" column="permission_id" javaType="com.real.fudousan.member.vo.Permission" resultMap="permissionResultMap"/>
	</resultMap>
	
	<resultMap type="permission" id="permissionResultMap">
		<id property="permissionId" column="permission_id"/>
		<result property="name" column="permission_name"/>
	</resultMap>
	
	<select id="selectMember" parameterType="member" resultMap="memberResultMap">
		SELECT
			member_id,
			email,
			password,
			phone,
			picture,
			text member_text,
			cre_date as "member_cre_date",
			del_date as "member_del_date",
			permission_id as "permission",
			designer,
			member_name as "member_name",
			permission.permission_id permission_id,
			permission.permission_name permission_name
		FROM
			member
		JOIN 
			permission
		ON
			member.permission_id = permission.permission_id
		WHERE
			<if test="email != null">
				email=#{email}
			</if>
			<if test="phone != null">
				phone=#{phone}
			</if>
	</select>
	
	
	<insert id="insertMember" parameterType="member">
		INSERT INTO 
		 member 
		(	
			
			member_name 
			,password
			,email
			,phone
			,picture
			,permission_id
			,designer
			,text
		)
		VALUES
		(	
			#{memberName}
			,#{password}
			,#{email}
			,#{phone}
			,#{picture}
			,#{permission.permissionId}
			,#{designer}
			,#{text}
		)
	</insert>
	
	
	<insert id="insertAgencyMember" parameterType="member" >
		INSERT INTO 
		 member 
		(	
			member_name 
			,password
			,email
			,phone
			,picture
			,permission_id
			,designer
			,text
		)
		VALUES
		(	
			#{memberName}
			,#{password}
			,#{email}
			,#{phone}
			,#{picture}
			,#{permission.permissionId}
			,#{designer}
			,#{text}
		)
		
	</insert>
	
	<insert id="insertAgency"  parameterType="agency">
	
	INSERT INTO 
		 agency
		(	
			agency_id
			,name 
			,biznum
			,address_main
			,address_middle
			,address_smail
			,address_sub
			,address_main
		)
		VALUES
		(	
			SEQ_AGENCY_ID.nextval
			,#{memberName}
			,#{password}
			,#{email}
			,#{phone}
			,#{picture}
			,#{permission.permissionId}
			,#{designer}
			,#{text}
		)
	</insert> 
	
</mapper>
