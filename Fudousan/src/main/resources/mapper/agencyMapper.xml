<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.real.fudousan.agency.dao.AgencyMapper">

	<resultMap type="agency" id="agencyResultMap">
		<id property="agencyId" column="agency_id"/>
		<result property="addressMain" column="address_main"/>
		<result property="addressMiddle" column="address_middle"/>
		<result property="addressSmall" column="address_small"/>
		<result property="addressSub" column="address_sub"/>
		<result property="biznum" column="biznum"/>
		<result property="confirm" column="confirm"/>
		<result property="creDate" column="cre_date"/>
		<result property="delDate" column="del_date"/>
		<result property="gpsX" column="gps_x"/>
		<result property="gpsY" column="gps_y"/>
		<result property="name" column="name"/>
		<result property="text" column="text"/>
		<association property="transType" column="trans_type_id" javaType="com.real.fudousan.estate.vo.TransType" resultMap="transtypeResultMap"/>
		<association property="member" column="member_id" javaType="com.real.fudousan.member.vo.Member" resultMap="memberResultMap"/>
	</resultMap>
	
	<resultMap type="transtype" id="transtypeResultMap">
			<id property="transTypeId" column="trans_type_id"/>
			<result property="transName" column="trans_name"/>
	</resultMap>
	
	<resultMap type="member" id="memberResultMap">
		<id property="memberId" column="member_id"/>
		<result property="creDate" column="member_cre_date"/>
		<result property="delDate" column="member_del_date"/>
		<result property="designer" column="designer"/>
		<result property="email" column="email"/>
		<result property="memberId" column="member_id"/>
		<result property="password" column="password"/>
		<result property="phone" column="phone"/>
		<result property="picture" column="picture"/>
		<result property="text" column="member_text"/>
		<!-- Permission -->
		<association property="permission" column="permission_id" javaType="com.real.fudousan.member.vo.Permission" resultMap="permissionResultMap"/>
	</resultMap>
	
	<resultMap type="permission" id="permissionResultMap">
		<id property="permissionId" column="permission_id"/>
		<result property="name" column="permission_name"/>
	</resultMap>

	<select id="selectByConfirmed" parameterType="int" resultMap="agencyResultMap">
		SELECT 
			address_main 
			, address_middle 
			, address_small 
			, address_sub 
			, agency_id 
			, biznum
			, confirm
			, agency.cre_date 
			, agency.del_date
			, gps_x 
			, gps_y 
			, name
			, agency.text
			-- TransType
			, trans_type_id
			, trans_name
			-- ыйды▓Д(member)
			, member_id
			, email
			, password
			, phone
			, picture
			, member.text member_text
			, member.cre_date member_cre_date
			, member.del_date member_del_date
			, designer
			-- Permission
			, permission_id
			, permission.name permission_name
		FROM
			agency
		JOIN
			member
		ON
			agency.member_id = member.member_id
		JOIN
			trans_type
		ON
			member.trans_type_id = trans_type.trans_type_id
		JOIN
			permission
		ON
			member.permission_id = permission.permission_id
		WHERE
			confirm = #{confirm}
	</select>
</mapper>
